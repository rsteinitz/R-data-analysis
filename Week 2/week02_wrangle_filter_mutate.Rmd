---
title: "Week 2: Wrangling Basics – Filter, Select, Mutate"
author: "Your Name"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 🧰 Load Required Packages

```{r, message=FALSE}
library(tidyverse)
library(palmerpenguins)  # dataset package from Data Carpentry
```

## 📦 Load and Preview the Dataset

We’ll be using `rat_growth` from the `ratdat` package. This dataset tracks individual rats on different diets over time.

```{r}
data <- penguins
glimpse(data)
head(data)
```

## ✂️ Filter and Select Columns

We often want to focus on specific variables or rows.

```{r}
# Select columns and filter rows where time is less than or equal to 20
filtered <- data %>%
  select(species, body_mass_g, sex, year) %>%
  filter(year > 2008)

head(filtered)
```

## ➕ Create a New Variable

Let’s convert weight from grams to kilograms using `mutate()`.

```{r}
filtered <- filtered %>%
  mutate(body_mass_kg = body_mass_g / 1000)
```

## 📊 Visualize the Filtered Data

Let’s look at how rat weight changes over time.

```{r}
ggplot(filtered, aes(x = species, y = body_mass_kg)) +
  geom_point() + #alpha = 0.5
  labs(title = "Penguin Body Mass", x = "Species", y = "Weight (kg)")
```

---

## 🧠 Practice Prompts (For Lab)

Start a **new R Markdown file** and try the following:

1. Select only the variables you need from your dataset.  
2. Filter the data to keep only a subset (e.g., specific group, time period).  
3. Create at least one new variable using `mutate()` (e.g., convert units, BMI).  
4. Make a scatterplot or histogram using the filtered or mutated data.  
5. Add informative titles and labels to your plots.

---

## ✅ Summary

This week we:
- Learned how to select and filter data using `dplyr`
- Created new columns with `mutate()`
- Built plots using wrangled data

Next week: group your data and calculate summary statistics!

---

## 🔍 Optional Explorations (Stretch Challenges)

### 1. Combine Wrangling Steps with the Pipe `%>%`

```{r}
# Filter, mutate, and plot in a single pipeline
data %>%
  filter(species == "Gentoo",  year <= 2008) %>%
  mutate(body_mass_kg = body_mass_g / 1000) %>%
  ggplot(aes(x = year, y = body_mass_kg)) +
  geom_point() +
  labs(title = "Group A Weight over Time", x = "Time", y = "Weight (kg)")

```

### 2. Use `case_when()` to Recode Categories

```{r}
# Create a new variable to label early vs late timepoints
filtered <- filtered %>%
  mutate(period = case_when(
    time <= 10 ~ "early",
    time > 10 ~ "late"
  ))

head(filtered)
```

### 3. Compare Subsets with `facet_wrap()`

```{r}
ggplot(filtered, aes(x = time, y = weight_kg)) +
  geom_point() +
  facet_wrap(~ group) +
  labs(title = "Weight Trajectories by Group", x = "Time", y = "Weight (kg)")
```

### 4. Reorder Factor Levels for Better Plots

```{r}
# Optional: if group isn't a factor, convert and reorder
filtered <- filtered %>%
  mutate(group = factor(group, levels = c("A", "B", "C")))

ggplot(filtered, aes(x = group, y = weight_kg)) +
  geom_boxplot()

# Filter with multiple conditions
# Rats in group A or C, and measured before day 15
data %>%
  filter(group %in% c("A", "C") & time < 15) %>%
  head()

# Create a BMI-like variable
# Assuming height_cm is a column (replace with real column if applicable)
data %>%
  mutate(bmi_like = weight / (height_cm / 100)^2) %>%
  select(group, weight, height_cm, bmi_like)

# Use if_else() instead of case_when() for binary categories
# Label each rat as "early" or "late" based on time
data %>%
  mutate(stage = if_else(time <= 10, "early", "late")) %>%
  select(group, time, stage)

# Make a histogram using filtered data only
# Visualize weight only for group B rats
data %>%
  filter(group == "B") %>%
  ggplot(aes(x = weight)) +
  geom_histogram(binwidth = 5, fill = "skyblue", color = "white") +
  labs(title = "Weight Distribution (Group B)", x = "Weight (g)", y = "Count")

# Plot a new variable created using mutate()
# Convert time to weeks, then plot
data %>%
  mutate(time_weeks = time / 7) %>%
  ggplot(aes(x = time_weeks, y = weight)) +
  geom_point() +
  labs(title = "Weight Over Time (Weeks)", x = "Time (weeks)", y = "Weight (g)")

# Compare a numeric variable across multiple categories with geom_boxplot()
ggplot(data, aes(x = group, y = weight)) +
  geom_boxplot(fill = "lightgreen") +
  labs(title = "Weight by Group", x = "Group", y = "Weight (g)")

# Use mutate() to categorize and then color by that category
data %>%
  mutate(size_class = case_when(
    weight < 250 ~ "small",
    weight >= 250 & weight < 300 ~ "medium",
    weight >= 300 ~ "large"
  )) %>%
  ggplot(aes(x = time, y = weight, color = size_class)) +
  geom_point() +
  labs(title = "Weight Over Time by Size Class", color = "Size Class")

```



